on:
  push:
    branches:
      master

jobs:
  build:
    name: Sphinx Pages
    runs-on: ubuntu-latest
    steps:
    - name: Start
      uses: actions/checkout@v2
      with:
        persist-credentials: false
        fetch-depth: 0

    - name: Sphinx Build
      uses: ammaraskar/sphinx-action@master
      with:
        docs-folder: "source/"
        pre-build-command: "apt-get update -y && mkdir -p /usr/share/man/man1 && apt-get install -y plantuml"
        build-command: "sphinx-build -b html . _build"

    - name: Clone documentation repo
      run: |
        git clone https://github.com/zhaoweiguo/www.zhaoweiguo.com.git  --branch master --single-branch zhaoweiguo
        rm -rf ./zhaoweiguo/kubernetes/*
        cp -r source/_build/* ./zhaoweiguo/kubernetes/
        cd ./zhaoweiguo
        git config --local user.email "zhaoweiguo@github.com"
        git config --local user.name "zhaoweiguo"
        git add .
        git commit -m "[github workflow kubernetes]Update changes"  -a || true


    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.ACCESS_TOKEN }}
        directory: zhaoweiguo
        repository: 'zhaoweiguo/www.zhaoweiguo.com'
        branch: master



